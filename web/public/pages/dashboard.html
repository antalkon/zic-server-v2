{{ define "dashboard" }}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ or .Title "Dashboard" }}</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .hover-card {
      transition: all 0.3s ease;
      cursor: pointer;
    }
    .hover-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    }
    
    .stats-item {
      position: relative;
      overflow: hidden;
    }
    .stats-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(0, 133, 255, 0.05), transparent);
      transition: left 0.5s ease;
    }
    .stats-item:hover::before {
      left: 100%;
    }
    
    .tooltip {
      opacity: 0;
      transform: translateY(10px);
      transition: all 0.3s ease;
      pointer-events: none;
    }
    .hover-card:hover .tooltip {
      opacity: 1;
      transform: translateY(0);
    }
    
    .pulse-animation {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
</head>
<body class="min-h-screen bg-[#eef6ff]">
  <div class="flex min-h-screen">
    <!-- Левая панель -->
    {{ template "nav_bar" . }}

    <!-- Правая область -->
    <div class="flex-1 flex flex-col">
      {{ template "header" . }}

<main class="px-4 sm:px-6 lg:px-8 pb-10">
  <!-- Контейнер с ограничением ширины на широких экранах -->
  <div class="max-w-[1400px] mx-auto">
    
    <!-- Приветствие -->
   <h1 class="text-[28px] sm:text-[34px] md:text-[38px] font-extrabold leading-tight text-black mb-6">
  Здравствуйте, <span id="greetName" class="text-[#0085FF]">{{ or .User.Name "Name" }}</span>
</h1>

    <!-- ===== РЯД 1 ===== -->
    <div class="grid grid-cols-1 lg:grid-cols-12 gap-4 sm:gap-6">
      <!-- Подписка -->
      <section class="lg:col-span-5">
        <div class="hover-card h-full min-h-[270px] rounded-2xl bg-[#0085FF] text-white p-4 sm:p-6 md:p-7 shadow flex flex-col relative"
             onclick="window.location.href='/subscription'">
          <div class="flex items-start justify-between">
            <div>
              <h2 class="text-[20px] sm:text-[22px] md:text-[24px] font-extrabold leading-none">Ваша подписка</h2>
              <p class="mt-1 text-sm md:text-[15px] opacity-90 leading-none">Light Core</p>
            </div>
            <div class="text-white/90 text-xl leading-none select-none">⋮</div>
          </div>

          <div class="mt-auto pt-4">
            <div class="text-[36px] sm:text-[40px] md:text-[44px] font-extrabold tracking-tight leading-none">
              20.000 ₽ в год
            </div>
            <div class="mt-3 text-sm md:text-[15px] opacity-95 leading-none">
              Продление: 25.01.2027
            </div>
          </div>
          
          <div class="tooltip absolute bottom-2 left-4 right-4">
            <p class="text-xs text-white/70">Нажмите для управления подпиской</p>
          </div>
        </div>
      </section>

      <!-- Статистика -->
      <section class="lg:col-span-7">
        <div class="hover-card h-full min-h-[300px] rounded-2xl bg-white p-4 sm:p-6 md:p-7 shadow flex flex-col relative"
             onclick="window.location.href='/statistics'">
          <h3 class="text-[20px] sm:text-[22px] md:text-[24px] font-bold leading-none mb-4 sm:mb-6">Статистика</h3>

          <div class="flex-1">
            <!-- Адаптивная сетка: на мобильных 2x2, на планшетах и десктопах 1x4 -->
            <div class="grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 lg:gap-6 h-full">
              <div class="stats-item flex flex-col justify-center p-2 sm:p-3 lg:p-0 rounded-lg lg:rounded-none">
                <div class="text-[40px] sm:text-[56px] lg:text-[72px] font-extrabold text-[#0085FF] leading-none tracking-tight">
                  05
                </div>
                <div class="mt-1 sm:mt-2">
                  <div class="text-[11px] sm:text-[13px] lg:text-[14px] text-gray-600 leading-tight">
                    Компьютеров<br>Онлайн
                  </div>
                </div>
              </div>

              <div class="stats-item flex flex-col justify-center p-2 sm:p-3 lg:p-0 rounded-lg lg:rounded-none">
                <div class="text-[40px] sm:text-[56px] lg:text-[72px] font-extrabold text-[#0085FF] leading-none tracking-tight">
                  12
                </div>
                <div class="mt-1 sm:mt-2">
                  <div class="text-[11px] sm:text-[13px] lg:text-[14px] text-gray-600 leading-tight">
                    Компьютеров<br>Оффлайн
                  </div>
                </div>
              </div>

              <div class="stats-item flex flex-col justify-center p-2 sm:p-3 lg:p-0 rounded-lg lg:rounded-none">
                <div class="text-[40px] sm:text-[56px] lg:text-[72px] font-extrabold text-[#0085FF] leading-none tracking-tight">
                  01
                </div>
                <div class="mt-1 sm:mt-2">
                  <div class="text-[11px] sm:text-[13px] lg:text-[14px] text-gray-600 leading-tight">
                    Кабинетов<br>Активно
                  </div>
                </div>
              </div>

              <div class="stats-item flex flex-col justify-center p-2 sm:p-3 lg:p-0 rounded-lg lg:rounded-none">
                <div class="text-[40px] sm:text-[56px] lg:text-[72px] font-extrabold text-[#0085FF] leading-none tracking-tight pulse-animation">
                  99+
                </div>
                <div class="mt-1 sm:mt-2">
                  <div class="text-[11px] sm:text-[13px] lg:text-[14px] text-gray-600 leading-tight">
                    Заданий<br>на проверке
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="tooltip absolute bottom-2 left-4 right-4">
            <p class="text-xs text-gray-500">Нажмите для подробной статистики</p>
          </div>
        </div>
      </section>
    </div>

    <!-- ===== РЯД 2 ===== -->
    <div class="mt-4 sm:mt-6 grid grid-cols-1 lg:grid-cols-12 gap-4 sm:gap-6">
      <!-- Логи -->
      <section class="lg:col-span-6">
        <div class="hover-card h-full min-h-[320px] rounded-2xl bg-white p-4 sm:p-6 md:p-7 shadow flex flex-col relative"
             onclick="window.location.href='/logs'">
          <div class="mb-4">
            <h3 class="text-[20px] sm:text-[22px] font-bold leading-none">Логи</h3>
            <p class="text-xs text-gray-500 mt-1 leading-none">4 июня 2025</p>
          </div>
          <ul class="space-y-3 text-[14px] sm:text-[15px] text-black/90">
            <li class="flex items-center gap-3">
              <span class="px-2 py-1 rounded-md bg-gray-100 text-gray-800 text-xs sm:text-sm leading-none flex-shrink-0">9:10</span>
              <span class="truncate">PC-B1 Включен</span>
            </li>
            <li class="flex items-center gap-3">
              <span class="px-2 py-1 rounded-md bg-gray-100 text-gray-800 text-xs sm:text-sm leading-none flex-shrink-0">9:08</span>
              <span class="truncate">PC-A3 Включен</span>
            </li>
            <li class="flex items-center gap-3">
              <span class="px-2 py-1 rounded-md bg-gray-100 text-gray-800 text-xs sm:text-sm leading-none flex-shrink-0">9:05</span>
              <span class="truncate">PC-A2 Выключен</span>
            </li>
            <li class="flex items-center gap-3">
              <span class="px-2 py-1 rounded-md bg-gray-100 text-gray-800 text-xs sm:text-sm leading-none flex-shrink-0">9:03</span>
              <span class="truncate">Вход с IP 128.127.225.111</span>
            </li>
            <li class="flex items-center gap-3">
              <span class="px-2 py-1 rounded-md bg-gray-100 text-gray-800 text-xs sm:text-sm leading-none flex-shrink-0">4:00</span>
              <span class="truncate">Система успешно перезагружена</span>
            </li>
          </ul>
          
          <div class="tooltip absolute bottom-2 left-4 right-4">
            <p class="text-xs text-gray-500">Нажмите для просмотра всех логов</p>
          </div>
        </div>
      </section>

      <!-- Правая колонка - адаптивная -->
      <section class="lg:col-span-6">
        <!-- На мобильных блоки друг под другом, на больших экранах рядом -->
        <div class="grid grid-cols-1 md:grid-cols-5 gap-4 sm:gap-6 h-full">
          <!-- Диагностика -->
          <div class="md:col-span-2">
  <div class="hover-card h-full min-h-[200px] md:min-h-[280px] rounded-2xl bg-[#9BE3A0] p-4 sm:p-5 md:p-6 shadow relative overflow-hidden"
       onclick="window.location.href='/diagnostics'">
    
    <!-- Заголовок -->
    <h3 class="text-[18px] sm:text-[20px] md:text-[22px] font-bold text-white leading-none">
      Диагностика
    </h3>
    
    <!-- Иконка (svg или png) -->
    <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
      <img src="/static/img/diag-su.svg" alt="Диагностика" 
           class="h-24 w-24 sm:h-28 sm:w-28 md:h-32 md:w-32" />
    </div>
    
    <!-- Текст внизу -->
    <div class="absolute bottom-3 sm:bottom-4 left-4 right-4">
      <p class="text-white font-semibold text-xs sm:text-sm">
        Все системы работают штатно!
      </p>
    </div>
    
    <!-- Tooltip -->
    <div class="tooltip absolute bottom-1 left-4 right-4">
      <p class="text-xs text-white/70">Нажмите для диагностики</p>
    </div>
  </div>
</div>

          <!-- Промо Core Plus -->
          <div class="md:col-span-3">
  <div class="hover-card h-full min-h-[250px] md:min-h-[340px] rounded-2xl shadow relative overflow-hidden flex flex-col"
       style='background-image:url("/static/img/sky-tex.svg"); background-size:cover; background-position:center;'
       onclick="window.location.href='/pricing'">
    
    <!-- Заголовок -->
    <div class="p-4 sm:p-6 md:p-7 text-white">
      <h3 class="text-[18px] sm:text-[20px] md:text-[24px] font-extrabold leading-snug">
        Перейдите на план<br/>Core Plus
      </h3>
      <p class="text-xs sm:text-sm opacity-90 mt-2 hidden sm:block">
        Больше возможностей и функций
      </p>
    </div>
    
    <!-- Кнопка -->
    <div class="p-4 sm:p-6 md:px-7 mt-auto">
      <button class="w-full sm:w-auto inline-flex items-center justify-center rounded-full bg-white text-[#0085FF] font-semibold px-4 sm:px-6 py-2 sm:py-3 text-sm sm:text-base shadow hover:shadow-md transition">
        Узнать подробнее
      </button>
    </div>
    
    <!-- Tooltip -->
    <div class="tooltip absolute bottom-1 left-4 right-4">
      <p class="text-xs text-white/70">Нажмите для просмотра планов</p>
    </div>
  </div>
</div>
      </section>
    </div>

  </div>
</main>
    </div>
  </div>
  <script>
document.addEventListener("DOMContentLoaded", async () => {
  const nameEl = document.getElementById("greetName");
  if (!nameEl) return;

  const applyName = (u) => {
    nameEl.textContent = (u && u.name) ? u.name : "No Data";
  };

  // 1) если хедер уже загрузил пользователя — берём из кэша
  if (window.__USER_DATA) {
    applyName(window.__USER_DATA);
    return;
  }

  // 2) иначе — тихо подтягиваем данные
  try {
    const res = await fetch("/api/v1/data/user/data", { credentials: "include" });
    if (!res.ok) throw new Error("HTTP " + res.status);
    const user = await res.json();
    applyName(user);
  } catch (e) {
    console.warn("Failed to load user for greeting:", e);
    applyName(null); // No Data
  }
});
</script>
</body>
</html>
{{ end }}